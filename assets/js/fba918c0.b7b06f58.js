"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[11139],{3905:(e,t,r)=>{r.d(t,{Zo:()=>m,kt:()=>d});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},m=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(r),d=a,k=c["".concat(l,".").concat(d)]||c[d]||u[d]||o;return r?n.createElement(k,i(i({ref:t},m),{},{components:r})):n.createElement(k,i({ref:t},m))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},85162:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(67294),a=r(86010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:r,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,i),hidden:r},t)}},65488:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(87462),a=r(67294),o=r(86010),i=r(72389),s=r(67392),l=r(7094),p=r(12466);const m="tabList__CuJ",u="tabItem_LNqP";function c(e){const{lazy:t,block:r,defaultValue:i,values:c,groupId:d,className:k}=e,g=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=c??g.map((e=>{let{props:{value:t,label:r,attributes:n}}=e;return{value:t,label:r,attributes:n}})),h=(0,s.l)(f,((e,t)=>e.value===t.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===i?i:i??g.find((e=>e.props.default))?.props.value??g[0].props.value;if(null!==N&&!f.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:b}=(0,l.U)(),[y,w]=(0,a.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,p.o5)();if(null!=d){const e=v[d];null!=e&&e!==y&&f.some((t=>t.value===e))&&w(e)}const D=e=>{const t=e.currentTarget,r=C.indexOf(t),n=f[r].value;n!==y&&(T(t),w(n),null!=d&&b(d,String(n)))},P=e=>{let t=null;switch(e.key){case"Enter":D(e);break;case"ArrowRight":{const r=C.indexOf(e.currentTarget)+1;t=C[r]??C[0];break}case"ArrowLeft":{const r=C.indexOf(e.currentTarget)-1;t=C[r]??C[C.length-1];break}}t?.focus()};return a.createElement("div",{className:(0,o.Z)("tabs-container",m)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":r},k)},f.map((e=>{let{value:t,label:r,attributes:i}=e;return a.createElement("li",(0,n.Z)({role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,key:t,ref:e=>C.push(e),onKeyDown:P,onClick:D},i,{className:(0,o.Z)("tabs__item",u,i?.className,{"tabs__item--active":y===t})}),r??t)}))),t?(0,a.cloneElement)(g.filter((e=>e.props.value===y))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==y})))))}function d(e){const t=(0,i.Z)();return a.createElement(c,(0,n.Z)({key:String(t)},e))}},55654:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>p,toc:()=>u});var n=r(87462),a=(r(67294),r(3905)),o=r(65488),i=r(85162);const s={title:"Configuring Persistent Data for Pipeline Components"},l=void 0,p={unversionedId:"reference-guides/pipelines/configure-persistent-data",id:"version-2.0-2.4/reference-guides/pipelines/configure-persistent-data",title:"Configuring Persistent Data for Pipeline Components",description:"The pipelines' internal Docker registry and the Minio workloads use ephemeral volumes by default. This default storage works out-of-the-box and makes testing easy, but you lose the build images and build logs if the node running the Docker Registry or Minio fails. In most cases this is fine. If you want build images and logs to survive node failures, you can configure the Docker Registry and Minio to use persistent volumes.",source:"@site/versioned_docs/version-2.0-2.4/reference-guides/pipelines/configure-persistent-data.md",sourceDirName:"reference-guides/pipelines",slug:"/reference-guides/pipelines/configure-persistent-data",permalink:"/v2.0-v2.4/reference-guides/pipelines/configure-persistent-data",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.0-2.4/reference-guides/pipelines/configure-persistent-data.md",tags:[],version:"2.0-2.4",lastUpdatedAt:1663953084,formattedLastUpdatedAt:"Sep 23, 2022",frontMatter:{title:"Configuring Persistent Data for Pipeline Components"},sidebar:"tutorialSidebar",previous:{title:"Pipeline Configuration Reference",permalink:"/v2.0-v2.4/reference-guides/pipelines/pipeline-configuration"},next:{title:"Example Repositories",permalink:"/v2.0-v2.4/reference-guides/pipelines/example-repositories"}},m={},u=[{value:"A. Configuring Persistent Data for Docker Registry",id:"a-configuring-persistent-data-for-docker-registry",level:3},{value:"B. Configuring Persistent Data for Minio",id:"b-configuring-persistent-data-for-minio",level:3}],c={toc:u};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The pipelines' internal Docker registry and the Minio workloads use ephemeral volumes by default. This default storage works out-of-the-box and makes testing easy, but you lose the build images and build logs if the node running the Docker Registry or Minio fails. In most cases this is fine. If you want build images and logs to survive node failures, you can configure the Docker Registry and Minio to use persistent volumes."),(0,a.kt)("p",null,"This section assumes that you understand how persistent storage works in Kubernetes. For more information, refer to the section on ",(0,a.kt)("a",{parentName:"p",href:"/v2.0-v2.4/how-to-guides/advanced-user-guides/manage-clusters/create-kubernetes-persistent-storage/manage-persistent-storage/about-persistent-storage"},"how storage works.")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Prerequisites (for both parts A and B):")),(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("a",{parentName:"p",href:"/v2.0-v2.4/pages-for-subheaders/create-kubernetes-persistent-storage"},"Persistent volumes")," must be available for the cluster.")),(0,a.kt)("h3",{id:"a-configuring-persistent-data-for-docker-registry"},"A. Configuring Persistent Data for Docker Registry"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the project that you're configuring a pipeline for, and click ",(0,a.kt)("strong",{parentName:"p"},"Resources > Workloads.")," In versions before v2.3.0, select the ",(0,a.kt)("strong",{parentName:"p"},"Workloads")," tab.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Find the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-registry")," workload and select ",(0,a.kt)("strong",{parentName:"p"},"\u22ee"," > Edit"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Scroll to the ",(0,a.kt)("strong",{parentName:"p"},"Volumes")," section and expand it. Make one of the following selections from the ",(0,a.kt)("strong",{parentName:"p"},"Add Volume")," menu, which is near the bottom of the section:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Add Volume > Add a new persistent volume (claim)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Add Volume > Use an existing persistent volume (claim)")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Complete the form that displays to choose a persistent volume for the internal Docker registry."),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"Add a new persistent volume",mdxType:"TabItem"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Enter a ",(0,a.kt)("strong",{parentName:"li"},"Name")," for the volume claim."),(0,a.kt)("li",{parentName:"ol"},"Select a volume claim ",(0,a.kt)("strong",{parentName:"li"},"Source"),":",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If you select ",(0,a.kt)("strong",{parentName:"li"},"Use a Storage Class to provision a new persistent volume"),", select a storage class and enter a ",(0,a.kt)("strong",{parentName:"li"},"Capacity"),"."),(0,a.kt)("li",{parentName:"ul"},"If you select ",(0,a.kt)("strong",{parentName:"li"},"Use an existing persistent volume"),", choose a ",(0,a.kt)("strong",{parentName:"li"},"Persistent Volume")," from the drop-down."))),(0,a.kt)("li",{parentName:"ol"},"From the ",(0,a.kt)("strong",{parentName:"li"},"Customize")," section, choose the read/write access for the volume."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Define"),"."))),(0,a.kt)(i.Z,{value:"Use an existing persistent volume",mdxType:"TabItem"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Enter a ",(0,a.kt)("strong",{parentName:"li"},"Name")," for the volume claim."),(0,a.kt)("li",{parentName:"ol"},"Choose a ",(0,a.kt)("strong",{parentName:"li"},"Persistent Volume Claim")," from the drop-down."),(0,a.kt)("li",{parentName:"ol"},"From the ",(0,a.kt)("strong",{parentName:"li"},"Customize")," section, choose the read/write access for the volume."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Define"),"."))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the ",(0,a.kt)("strong",{parentName:"p"},"Mount Point")," field, enter ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/registry"),", which is the data storage path inside the Docker registry container.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"Upgrade"),"."))),(0,a.kt)("h3",{id:"b-configuring-persistent-data-for-minio"},"B. Configuring Persistent Data for Minio"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the project view, click ",(0,a.kt)("strong",{parentName:"p"},"Resources > Workloads.")," (In versions before v2.3.0, click the ",(0,a.kt)("strong",{parentName:"p"},"Workloads")," tab.) Find the ",(0,a.kt)("inlineCode",{parentName:"p"},"minio")," workload and select ",(0,a.kt)("strong",{parentName:"p"},"\u22ee"," > Edit"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Scroll to the ",(0,a.kt)("strong",{parentName:"p"},"Volumes")," section and expand it. Make one of the following selections from the ",(0,a.kt)("strong",{parentName:"p"},"Add Volume")," menu, which is near the bottom of the section:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Add Volume > Add a new persistent volume (claim)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Add Volume > Use an existing persistent volume (claim)")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Complete the form that displays to choose a persistent volume for the internal Docker registry."),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"Add a new persistent volume",mdxType:"TabItem"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Enter a ",(0,a.kt)("strong",{parentName:"li"},"Name")," for the volume claim."),(0,a.kt)("li",{parentName:"ol"},"Select a volume claim ",(0,a.kt)("strong",{parentName:"li"},"Source"),":",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If you select ",(0,a.kt)("strong",{parentName:"li"},"Use a Storage Class to provision a new persistent volume"),", select a storage class and enter a ",(0,a.kt)("strong",{parentName:"li"},"Capacity"),"."),(0,a.kt)("li",{parentName:"ul"},"If you select ",(0,a.kt)("strong",{parentName:"li"},"Use an existing persistent volume"),", choose a ",(0,a.kt)("strong",{parentName:"li"},"Persistent Volume")," from the drop-down."))),(0,a.kt)("li",{parentName:"ol"},"From the ",(0,a.kt)("strong",{parentName:"li"},"Customize")," section, choose the read/write access for the volume."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Define"),"."))),(0,a.kt)(i.Z,{value:"Use an existing persistent volume",mdxType:"TabItem"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Enter a ",(0,a.kt)("strong",{parentName:"li"},"Name")," for the volume claim."),(0,a.kt)("li",{parentName:"ol"},"Choose a ",(0,a.kt)("strong",{parentName:"li"},"Persistent Volume Claim")," from the drop-down."),(0,a.kt)("li",{parentName:"ol"},"From the ",(0,a.kt)("strong",{parentName:"li"},"Customize")," section, choose the read/write access for the volume."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Define"),"."))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the ",(0,a.kt)("strong",{parentName:"p"},"Mount Point")," field, enter ",(0,a.kt)("inlineCode",{parentName:"p"},"/data"),", which is the data storage path inside the Minio container.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"Upgrade"),"."))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Result:")," Persistent storage is configured for your pipeline components."))}d.isMDXComponent=!0}}]);