"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[86006],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,h=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(h,i(i({ref:t},c),{},{components:n})):r.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,i),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(87462),a=n(67294),o=n(86010),i=n(72389),l=n(67392),s=n(7094),u=n(12466);const c="tabList__CuJ",d="tabItem_LNqP";function p(e){const{lazy:t,block:n,defaultValue:i,values:p,groupId:m,className:h}=e,g=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=p??g.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),b=(0,l.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===i?i:i??g.find((e=>e.props.default))?.props.value??g[0].props.value;if(null!==v&&!f.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:k,setTabGroupChoices:y}=(0,s.U)(),[N,w]=(0,a.useState)(v),T=[],{blockElementScrollPositionUntilNextRender:O}=(0,u.o5)();if(null!=m){const e=k[m];null!=e&&e!==N&&f.some((t=>t.value===e))&&w(e)}const C=e=>{const t=e.currentTarget,n=T.indexOf(t),r=f[n].value;r!==N&&(O(t),w(r),null!=m&&y(m,String(r)))},R=e=>{let t=null;switch(e.key){case"Enter":C(e);break;case"ArrowRight":{const n=T.indexOf(e.currentTarget)+1;t=T[n]??T[0];break}case"ArrowLeft":{const n=T.indexOf(e.currentTarget)-1;t=T[n]??T[T.length-1];break}}t?.focus()};return a.createElement("div",{className:(0,o.Z)("tabs-container",c)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},h)},f.map((e=>{let{value:t,label:n,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>T.push(e),onKeyDown:R,onClick:C},i,{className:(0,o.Z)("tabs__item",d,i?.className,{"tabs__item--active":N===t})}),n??t)}))),t?(0,a.cloneElement)(g.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,i.Z)();return a.createElement(p,(0,r.Z)({key:String(t)},e))}},36106:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>d});var r=n(87462),a=(n(67294),n(3905)),o=n(65488),i=n(85162);const l={title:"Route Configuration"},s=void 0,u={unversionedId:"reference-guides/monitoring-v2-configuration/routes",id:"reference-guides/monitoring-v2-configuration/routes",title:"Route Configuration",description:"The route configuration is the section of the Alertmanager custom resource that controls how the alerts fired by Prometheus are grouped and filtered before they reach the receiver.",source:"@site/docs/reference-guides/monitoring-v2-configuration/routes.md",sourceDirName:"reference-guides/monitoring-v2-configuration",slug:"/reference-guides/monitoring-v2-configuration/routes",permalink:"/reference-guides/monitoring-v2-configuration/routes",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/reference-guides/monitoring-v2-configuration/routes.md",tags:[],version:"current",lastUpdatedAt:1666730461,formattedLastUpdatedAt:"Oct 25, 2022",frontMatter:{title:"Route Configuration"},sidebar:"tutorialSidebar",previous:{title:"Receiver Configuration",permalink:"/reference-guides/monitoring-v2-configuration/receivers"},next:{title:"ServiceMonitor and PodMonitor Configuration",permalink:"/reference-guides/monitoring-v2-configuration/servicemonitors-and-podmonitors"}},c={},d=[{value:"Route Restrictions",id:"route-restrictions",level:2},{value:"Route Configuration",id:"route-configuration",level:2},{value:"Note on Labels and Annotations",id:"note-on-labels-and-annotations",level:3},{value:"Receiver",id:"receiver",level:3},{value:"Grouping",id:"grouping",level:3},{value:"Matching",id:"matching",level:3}],p={toc:d};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The route configuration is the section of the Alertmanager custom resource that controls how the alerts fired by Prometheus are grouped and filtered before they reach the receiver."),(0,a.kt)("p",null,"When a Route is changed, the Prometheus Operator regenerates the Alertmanager custom resource to reflect the changes."),(0,a.kt)("p",null,"For more information about configuring routes, refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://www.prometheus.io/docs/alerting/latest/configuration/#route"},"official Alertmanager documentation.")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This section assumes familiarity with how monitoring components work together. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works"},"this section."))),(0,a.kt)("h2",{id:"route-restrictions"},"Route Restrictions"),(0,a.kt)("p",null,"Alertmanager proxies alerts for Prometheus based on its receivers and a routing tree that filters alerts to certain receivers based on labels."),(0,a.kt)("p",null,"Alerting drivers proxy alerts for Alertmanager to non-native receivers, such as Microsoft Teams and SMS."),(0,a.kt)("p",null,"In the Rancher UI for configuring routes and receivers, you can configure routing trees with one root and then a depth of one more level, for a tree with a depth of two. But if you use a ",(0,a.kt)("inlineCode",{parentName:"p"},"continue")," route when configuring Alertmanager directly, you can make the tree deeper."),(0,a.kt)("p",null,"Each receiver is for one or more notification providers. So if you know that every alert for Slack should also go to PagerDuty, you can configure both in the same receiver."),(0,a.kt)("h2",{id:"route-configuration"},"Route Configuration"),(0,a.kt)("h3",{id:"note-on-labels-and-annotations"},"Note on Labels and Annotations"),(0,a.kt)("p",null,"Labels should be used for identifying information that can affect the routing of notifications. Identifying information about the alert could consist of a container name, or the name of the team that should be notified."),(0,a.kt)("p",null,"Annotations should be used for information that does not affect who receives the alert, such as a runbook url or error message."),(0,a.kt)("h3",{id:"receiver"},"Receiver"),(0,a.kt)("p",null,"The route needs to refer to a ",(0,a.kt)("a",{parentName:"p",href:"#receiver-configuration"},"receiver")," that has already been configured."),(0,a.kt)("h3",{id:"grouping"},"Grouping"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"Rancher v2.6.5+",mdxType:"TabItem"},(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"As of Rancher v2.6.5, ",(0,a.kt)("inlineCode",{parentName:"p"},"Group By")," now accepts a list of strings instead of key-value pairs. See the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#route"},"upstream documentation")," for details.")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Field"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group By"),(0,a.kt)("td",{parentName:"tr",align:null},"N/a"),(0,a.kt)("td",{parentName:"tr",align:null},'List of labels to group by. Labels must not be repeated (unique list). Special label "..." (aggregate by all possible labels), if provided, must be the only element in the list.')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group Wait"),(0,a.kt)("td",{parentName:"tr",align:null},"30s"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait to buffer alerts of the same group before sending initially.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group Interval"),(0,a.kt)("td",{parentName:"tr",align:null},"5m"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait before sending an alert that has been added to a group of alerts for which an initial notification has already been sent.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Repeat Interval"),(0,a.kt)("td",{parentName:"tr",align:null},"4h"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait before re-sending a given alert that has already been sent."))))),(0,a.kt)(i.Z,{value:"Rancher before v2.6.5",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Field"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group By"),(0,a.kt)("td",{parentName:"tr",align:null},"N/a"),(0,a.kt)("td",{parentName:"tr",align:null},"The labels by which incoming alerts are grouped together. For example, ",(0,a.kt)("inlineCode",{parentName:"td"},"[ group_by: '[' <labelname>, ... ']' ]")," Multiple alerts coming in for labels such as ",(0,a.kt)("inlineCode",{parentName:"td"},"cluster=A")," and ",(0,a.kt)("inlineCode",{parentName:"td"},"alertname=LatencyHigh")," can be batched into a single group. To aggregate by all possible labels, use the special value ",(0,a.kt)("inlineCode",{parentName:"td"},"'...'")," as the sole label name, for example: ",(0,a.kt)("inlineCode",{parentName:"td"},"group_by: ['...']"),"  Grouping by ",(0,a.kt)("inlineCode",{parentName:"td"},"...")," effectively disables aggregation entirely, passing through all alerts as-is. This is unlikely to be what you want, unless you have a very low alert volume or your upstream notification system performs its own grouping.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group Wait"),(0,a.kt)("td",{parentName:"tr",align:null},"30s"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait to buffer alerts of the same group before sending initially.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Group Interval"),(0,a.kt)("td",{parentName:"tr",align:null},"5m"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait before sending an alert that has been added to a group of alerts for which an initial notification has already been sent.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Repeat Interval"),(0,a.kt)("td",{parentName:"tr",align:null},"4h"),(0,a.kt)("td",{parentName:"tr",align:null},"How long to wait before re-sending a given alert that has already been sent.")))))),(0,a.kt)("h3",{id:"matching"},"Matching"),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"Match")," field refers to a set of equality matchers used to identify which alerts to send to a given Route based on labels defined on that alert. When you add key-value pairs to the Rancher UI, they correspond to the YAML in this format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"match:\n  [ <labelname>: <labelvalue>, ... ]\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"Match Regex")," field refers to a set of regex-matchers used to identify which alerts to send to a given Route based on labels defined on that alert. When you add key-value pairs in the Rancher UI, they correspond to the YAML in this format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"match_re:\n  [ <labelname>: <regex>, ... ]\n")))}m.isMDXComponent=!0}}]);